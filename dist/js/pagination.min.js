/*
 *  jQuery Pagination - v0.0.2
 *  JQuery plugin for paginated output of data with extra goodies.
 *  https://github.com/dreef3/jquery-paged
 *
 *  Made by Andrey Ermakov
 *  Under Apache License
 */
!function(a){"use strict";function b(a,b){b=b.split(".");for(var c=0;c<b.length;c++){if(!a)return null;a=a[b[c]]}return a}function c(a,b,c){b=b.split(".");for(var d;b.length>1&&(d=b.shift());)a=a[d]||(a[d]={});a[b.shift()]=c}function d(a,b){b=b.split(".");for(var c;b.length>1&&(c=b.shift());)if(a=a[c],!a)return;delete a[b.shift()]}a.widget("drf.pagination",{options:{page:1,limit:10,offset:0,total:null,template:null,pagesTemplate:null,url:null,data:null,pages:{attr:"data-page",total:5},css:{items:"pg-items",pages:"pg-pager",targets:{previous:"pg-previous",next:"pg-next",pageBefore:"pg-page-before",pageAfter:"pg-page-after",pageCurrent:"pg-page-current"}},keys:{root:"root",total:"total",limit:"limit",offset:"offset"},templateKeys:{array:"data",totalPages:"total",currentPage:"current",extra:"extra",limit:"limit",offset:"offset"},load:null,paginated:null,render:null,ajax:null},_create:function(){this._initComplete=!1,this._setOptions(this.options),this._initComplete=!0},_setTemplate:function(b){var c="_"+b;if(a.isFunction(this.options[b]))this[c]=this.options[b];else if(this.options[b]){if(void 0===_)throw new Error("Underscore.js wasn't found. It's a default template engine");this[c]=_.template(this.options[b])}},_setTotal:function(){var a=this.options.keys.total,c=this.options.keys.root;if(this._total=this.options.total,this._data){var d=b(this._data,c);this._total=this._total&&d.length<this._total?d.length:this._data[a]?this._data[a]:d.length}},_setPage:function(){if(this._limit=this.options.limit,this._offset=this.options.offset+this._limit*this.options.page,this._total){var a=this.options.page,b=this.options.limit,c=this.options.offset,d=c+b*(a-1);this._total>d&&(this._total<d+b&&(b=this._total-d),this._currentPage=a,this._totalPages=Math.floor(this._total/this._limit),this._total%this._limit>0&&this._totalPages++,this.options.pages.total>this._totalPages&&(this.options.pages.total=this._totalPages),this._limit=b,this._offset=d)}},_setDataSource:function(a){this._reset(),this._load=a,this._initComplete&&this._load()},_validateOption:function(b,c){var d=!0;switch(b){case"limit":case"offset":case"total":d=a.isNumeric(c)&&c>=0;break;case"page":this._totalPages&&(d=a.isNumeric(c)&&c>0&&c<=this._totalPages);break;case"template":if(d=!!c,!d)throw new Error("Template wasn't set!")}return d},_setOption:function(a,b){if(this._validateOption(a,b))switch(this._super(a,b),a){case"template":this._setTemplate("template");break;case"pagesTemplate":this._setTemplate("pagesTemplate");break;case"page":this._setPage();break;case"limit":case"offset":this._setPage();break;case"total":this._setTotal();break;case"url":this._setDataSource(this._loadRemote);break;case"data":null!==b&&this._setDataSource(this._loadLocal)}},_setOptions:function(a){this._super(a),this.refresh()},_reset:function(){this._data=null,this._currentData=null,this._total=null},_destroy:function(){},_loadLocal:function(){this._saveData(this.options.data),this.refresh()},_loadRemote:function(){var b={url:this.options.url,type:"POST",dataType:"json",data:{}};b.data[this.options.keys.offset]=this._offset,b.data[this.options.keys.limit]=this._limit,this._trigger("ajax",null,b);var c=this;a.ajax(b).done(function(a){c._trigger("load",null,a),c._saveData(a),c.refresh()}).fail(function(){})},_setCurrentData:function(){var c=this.options.templateKeys,e=this.options.keys.root,f=b(this._data,e),g={};if(this._setTotal(),this._setPage(),!f||f.length<this._offset)return this._load(),!1;a.extend(!0,g,this._data),this._setPaginationData(g);var h=g[c.extra].pages,i=this._offset-h.before*this._limit,j=i+this._limit*(h.before+h.after+1);return g[c.array]=f.slice(i,j),g[c.offset]=h.before*this._limit,g[c.limit]=this._limit,d(g,e),this._trigger("paginated",null,g),this._currentData=g,!0},_setPaginationData:function(a){var b=this.options.templateKeys;a[b.currentPage]=this._currentPage,a[b.totalPages]=this._totalPages,a[b.extra]={pages:this.options.pages,css:this.options.css};var c=a[b.extra].pages;c.before=Math.floor(c.total/2),this._currentPage-c.before<=0&&(c.before=this._currentPage-1),c.after=c.total-c.before-1,this._totalPages-this._currentPage<c.after&&(c.after=this._totalPages-this._currentPage),c.after+c.before+1<c.total&&(c.before=c.total-c.after-1),c.first=1===this._currentPage,c.last=this._currentPage===this._totalPages},_createTargets:function(){var a={};return a[this.options.css.targets.previous]=this.previous,a[this.options.css.targets.next]=this.next,a[this.options.css.targets.pageBefore]=this.go,a[this.options.css.targets.pageAfter]=this.go,a},_bindTargets:function(){var b=this._createTargets(),c=this;a.each(b,function(b,d){a("."+b).each(function(){var b=a(this);b.click(function(a){a.preventDefault(),d.call(c,b.attr(c.options.pages.attr))})})})},_saveData:function(c){if(a.isArray(c))this._saveArray(c);else{var d=this.options.keys.root;d&&c&&this._data&&a.isArray(b(c,d))&&a.isArray(b(this._data,d))?this._saveExistingObject(c):this._saveNewObject(c)}},_saveExistingObject:function(c){var d=this.options.keys.root,e=this.options.keys.offset,f=this.options.keys.limit,g=this._limit,h=this._offset;a.isNumeric(b(c,f))&&(g=parseInt(b(c,f),10)),a.isNumeric(b(c,e))&&(h=parseInt(b(c,e),10));var i=[h,g].concat(b(c,d));Array.prototype.splice.apply(b(this._data,d),i)},_saveArray:function(a){var d=this.options.keys.root;this._data=this._data||{},c(this._data,d,b(this._data,d)||[]);for(var e=b(this._data,d),f=0;f<a.length;f++)e.push(a[f])},_saveNewObject:function(c){var d=this.options.keys.root,e=b(c,d);a.isArray(e)||a.each(c,function(b,c){return d?(d=null,!1):(a.isArray(c)&&(d=b),!0)}),d&&(this.options.keys.root=d,this._data=a.extend(!0,{},c))},go:function(a){this._setOption("page",parseInt(a)),this.refresh()},forward:function(){this.go(this._currentPage+1)},back:function(){this.go(this._currentPage-1)},previous:function(){this.back()},next:function(){this.forward()},refresh:function(){if(this._setCurrentData()){this.element.html(this._template(this._currentData));var b=this;this._pagesTemplate&&this.element.find("."+this.options.css.pages).each(function(){a(this).html(b._pagesTemplate(b._currentData))}),this._bindTargets(),this._trigger("render",null,{element:this.element,data:a.extend(!0,{},this._currentData)})}}})}(jQuery);