/*
 *  jQuery Paged - v0.0.1
 *  JQuery plugin for paged output of data with extra goodies.
 *  https://github.com/dreef3/jquery-paged
 *
 *  Made by Andrey Ermakov
 *  Under Apache License
 */
!function(a){function b(b,e){this.element=b,this.$element=a(b),this.settings=a.extend(!0,{},d,e),this._defaults=d,this._name=c,this.init()}var c="paged",d={render:null,template:"<ul><li>Nothing here yet</li></ul>",events:{afterRender:null,beforeLoad:null,afterLoad:null,loadFail:null},targets:{previous:".paged-previous",next:".paged-next",page:".paged-page-before, .paged-page-after"},ajax:{url:null,data:null},data:null,pages:{before:1,after:1,template:"<ul class='paged-pager-list'><% if (current > 1) { %><li class='paged-previous paged-control'><a href='#'><i class='fa fa-long-arrow-left'></i></a></li><% for(var i = pagesBefore; i > 0; i--) { %><li class='paged-page-before' data-page='<%=current - i%>'><a href='#'><%=current - i%></a></li><% } %><% } else { %><li class='paged-control'><a href='#'><i class='fa fa-dot-circle-o'></i></a></li><% } %><li class='paged-page-current'><a href='#'><%=current%></a></li><% if (!isLast) { %><% for(var i = 1; i <= pagesAfter; i++) { %><li class='paged-page-after' data-page='<%=current + i%>'><a href='#'><%=current + i%></a></li><% } %><li class='paged-next paged-control'><a href='#'><i class='fa fa-long-arrow-right'></i></a></li><% } else { %><li class='paged-control'><a href='#'><i class='fa fa-dot-circle-o'></i></a></li><% } %></ul>",render:null,el:null,position:"after"},limit:10,offset:0,total:null};b.prototype={init:function(){if(!a.isFunction(this.settings.render)){if(this.settings.render=null,"undefined"==typeof _)throw new Error("Underscore was not found. Please include underscore.js OR provide a custom render function.");this._compiledTemplate=_.template(this.settings.template)}if(this.$element.html('<div class="paged-items"></div>'),this.$container=a(".paged-items",this.element),!this.settings.total&&this.settings.data&&(this.settings.total=this.settings.data.root?this.settings.data[this.settings.data.root].length:this.settings.data.length),this.settings.total&&this.settings.total>this.settings.limit?this._initPager():this.$pager=null,!this.settings.data&&!this.settings.ajax.url)throw new Error("Neither data nor URL template weren't set!");if(this.settings.data&&!this.settings.data.root&&!a.isArray(this.settings.data))throw new Error("Paginated data must be set as array.");this.settings.ajax.url&&(this._compiledUrl=_.template(this.settings.ajax.url)),this.settings.offset-=this.settings.limit,this.go(1)},_initPager:function(){if(this.settings.pages.el)this.$pager=a(this.settings.pages.el),this.$pager.each(function(){a(this).addClass(".paged-pager")});else{if("before"===this.settings.pages.position)this.$element.prepend('<div class="paged-pager"></div>');else{if("after"!==this.settings.pages.position)throw new Error("Invalid pagination position! Can be one of: before, after");this.$element.append('<div class="paged-pager"></div>')}this.$pager=a(".paged-pager",this.element)}if(!a.isFunction(this.settings.pages.render)){if(this.settings.pages.render=null,"undefined"==typeof _)throw new Error("Underscore was not found. Please include underscore.js OR provide a custom pages.render function.");this._compiledPagerTemplate=_.template(this.settings.pages.template)}},_evalPages:function(a,b,c){(!this.settings.total||c)&&(this.settings.total=c,this._totalPages=this.settings.total/this.settings.limit,this.settings.total%this.settings.limit>0&&this._totalPages++),this._currentPage=a/b+1,this._isLastPage=a+b===this.settings.total},_disableNavigation:function(a){this.$pager&&this.$pager.prop("disabled",a)},forward:function(){this.go(this._currentPage+1)},go:function(a){this.settings.offset=this.settings.limit*(a-1);var b=this.settings.limit;this.settings.total&&this.settings.offset+b>this.settings.total&&(b=this.settings.total-this.settings.offset),this.settings.data?this._load(this.settings.offset,b):this._loadRemote(this.settings.offset,b)},back:function(){this.go(this._currentPage-1)},_load:function(b,c,d){this._evalPages(b,c,d?d.total:this.settings.total),!this.$pager&&this.settings.total>this.settings.limit&&this._initPager();var e=d;if(!e){var f=this.settings.data.root;f?(e=a.extend(!0,{},this.settings.data),e[f]=this.settings.data[f].slice(b,b+c)):e=this.settings.data.slice(b,b+c)}this._render(e),this._renderPager(),a.isFunction(this.settings.afterRender)&&this.settings.afterRender().call(this,this.element,d)},_beforeLoad:function(b){a.isFunction(this.settings.events.beforeLoad)&&this.settings.events.beforeLoad.call(this,b)},_afterLoad:function(b){this.settings.events.afterLoad&&this.settings.events.afterLoad.call(this,a.extend(!0,{},b,{currentPage:this._currentPage,totalPages:this._totalPages,isLastPage:this._isLastPage}))},_loadRemote:function(b,c){this._disableNavigation(!0);var d=(this._compiledUrl({offset:b,limit:c}),a.extend(!0,{},this.settings.ajax,{url:this._compiledUrl(b,c),data:{offset:b,limit:c,total:this.settings.total}}));this._beforeLoad(d),a.ajax(d).done(function(a){this._load(b,c,a),this._afterLoad(a),this._disableNavigation(!1)}.bind(this)).fail(function(b,c,d){a.isFunction(this.settings.events.loadFail)&&this.settings.events.loadFail.call(this,d),console.log(d)}.bind(this))},_renderPager:function(){if(this.$pager){var a=this.settings.pages.before;a>this._currentPage-1&&(a=this._currentPage-1);var b=this.settings.pages.after;b>this._totalPages-this._currentPage&&(b=this._totalPages-this._currentPage);var c={current:this._currentPage,isLast:this._isLastPage,pagesBefore:a,pagesAfter:b,totalPages:this._totalPages};this.$pager.children().remove(),this.settings.pages.render?this.$pager.html(this.settings.pages.render.apply(this,[c])):this.$pager.html(this._compiledPagerTemplate(c)),this._bindEvents()}},_bindEvents:function(){var b=this;this.settings.targets.next&&a(this.settings.targets.next,this.$pager.get()).each(function(){a(this).click(b.forward.bind(b))}),this.settings.targets.previous&&a(this.settings.targets.previous,this.$pager.get()).each(function(){a(this).click(function(){b.back()})}),this.settings.targets.page&&a(this.settings.targets.page,this.$pager.get()).each(function(){var c=a(this),d=c.attr("data-page");d&&c.click(b.go.bind(b,parseInt(d)))})},_render:function(a){this.$container.children().remove(),this.settings.render?this.$container.html(this.settings.render.apply(this,[a])):this.$container.html(this._compiledTemplate(a))}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);